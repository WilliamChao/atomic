<!DOCTYPE html>
<html>
<head>
<title>atomic: level editor</title>

<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript">
var gl;
var ext;
var timer;
var frame = 0;
var delay = 1/30;
var starttime = new Date().getTime();
var mouseX = 0.5;
var mouseY = 0.5;
var oldMouseX = 0;
var oldMouseY = 0;
var mouseDx = 0;
var mouseDy = 0;



function updateFPS() {
	document.getElementById("fps").textContent = frame;
	frame = 0;
}

requestAnimFrame = (function() {
	return window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame ||
	function(callback, element) {
		setTimeout(callback, 1000 / 60);
	};
})();

function load()
{
	clearInterval(timer);
	var c = document.getElementById("c");
	try {
		gl = c.getContext("experimental-webgl", { depth: false });
	}
	catch(e) {
	}
	if (!gl) {
		alert("WebGL is not supported on this browser.");
		return;
	}

	document.onmousemove = function(evt) {
		mouseX = evt.pageX / c.width;
		mouseY = evt.pageY / c.height;
	};

	document.onclick = function(evt) {
		mouseX = evt.pageX / c.width;
		mouseY = evt.pageY / c.height;
		if(mouseX<=1.0 && mouseY<=1.0) {
			postCommand("/command", {});
		}
	};


	timer = setInterval(updateFPS, 1000);
	time = new Date().getTime() - starttime;

	gl.blendFunc(gl.SRC_ALPHA, gl.ONE);
	gl.clearColor(0, 0, 0, 1);

	anim();
}

function anim()
{
	gl.clearColor(0, 0, 0, 1);
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

	frame++;
	setTimeout("requestAnimFrame(anim)", delay);

	oldMouseX = mouseX;
	oldMouseY = mouseY;
}


function postCommand(url, values)
{
	var ajax = new Ajax.Request("/command",
	{
		method: "post",
		parameters: "command=create",
		onComplete: function(req) {
		}
	});
}

</script>

</head>

<body onload="load()" ondblclick="hide()">
<canvas id="c" width="1024" height="1024" style="position:absolute; left:0px; top:0px;"></canvas>
<div id="desc" style="position:absolute; left:1024px; top:10px;">
<span id="fps"></span>
<a href="http://primitive-games.jp/atomic/">about atomic</a>
</div>
</body>

</html>
